<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Livro + Comentários</title>
  <style>
   /* Variáveis para o tema escuro (padrão) */
/* Variáveis para o tema escuro (padrão) */
:root {
    --bg-dark: #1e1e1e; /* Darker background for chat feel */
    --fg-dark: #ffffff;
    --accent-dark: #5865f2; /* Azul mais forte */
    --border-dark: #36393f; /* Darker border for chat feel */
    --comment-bg-dark: #36393f; /* Discord dark grey for comments */
    --comment-own-bg-dark: #4f545c; /* Slightly lighter grey for own comments */
    --admin-bg-dark: var(--comment-bg-dark); /* AGORA IGUAL AO DO COMENTÁRIO NORMAL */
    --input-bg-dark: #40444b;
    --button-hover-dark: #4752c4; /* Ajuste para o hover do botão */
    --container-bg-dark: #2f3136;
    --reply-block-bg-dark: #40444b;
    --reply-block-message-dark: #b9bbbe;
    --reply-highlight-bg-dark: #4a5a6b; /* Fundo azul mais escuro para destaque de resposta (para mim) */
    --reply-highlight-border-dark: #4a90e2; /* Borda azul mais vibrante para destaque */
}

/* Variáveis para o tema claro */
body:not(.dark-mode) {
    --bg: #f5f5f5; /* Fundo muito claro */
    --fg: #333333; /* Texto escuro */
    --accent: #007bff; /* Azul padrão do bootstrap para botões */
    --border: #cccccc; /* Borda clara */
    --comment-bg: #ffffff; /* Fundo branco para comentários */
    --comment-own-bg: #e0f2f7; /* Azul bem clarinho para comentários próprios */
    --admin-bg: var(--comment-bg); /* AGORA IGUAL AO DO COMENTÁRIO NORMAL */
    --input-bg: #ffffff;
    --button-hover: #0056b3; /* Hover mais escuro para botões azuis */
    --container-bg: #ffffff; /* Fundo do container branco */
    --reply-block-bg: #e9ecef; /* Cinza claro para bloco de resposta */
    --reply-block-message: #666666; /* Texto cinza escuro para snippet */
    --reply-highlight-bg: #d4edda; /* Fundo verde claro para destaque de resposta (para mim) */
    --reply-highlight-border: #28a745; /* Borda verde para destaque */
}

/* Aplica variáveis do tema escuro por padrão ou quando a classe dark-mode está presente */
body.dark-mode {
    --bg: var(--bg-dark);
    --fg: var(--fg-dark);
    --accent: var(--accent-dark);
    --border: var(--border-dark);
    --comment-bg: var(--comment-bg-dark);
    --comment-own-bg: var(--comment-own-bg-dark);
    --admin-bg: var(--admin-bg-dark);
    --input-bg: var(--input-bg-dark);
    --button-hover: var(--button-hover-dark);
    --container-bg: var(--container-bg-dark);
    --reply-block-bg: var(--reply-block-bg-dark);
    --reply-block-message: var(--reply-block-message-dark);
    --reply-highlight-bg: var(--reply-highlight-bg-dark);
    --reply-highlight-border: var(--reply-highlight-border-dark);
}

* { box-sizing: border-box; }
body {
    font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif; /* Discord font stack */
    background: var(--bg);
    color: var(--fg);
    padding: 20px;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    transition: background-color 0.3s ease, color 0.3s ease; /* Transição suave para tema */
}
.container {
    max-width: 700px; /* Slightly wider for chat layout */
    width: 100%;
    margin: auto;
    background: var(--container-bg);
    padding: 30px;
    border-radius: 8px; /* Slightly less rounded */
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    gap: 15px;
    transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}
h2 {
    text-align: center;
    color: var(--fg);
    margin-bottom: 20px;
}
#user-info-section {
    text-align: center;
}
#user-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap; /* Allow wrapping on smaller screens */
    justify-content: center; /* Centraliza os botões */
}
#comment-form {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px; /* Less margin */
}
#comment-form input,
#comment-form textarea {
    padding: 12px;
    background: var(--input-bg);
    border: 1px solid var(--border);
    color: var(--fg);
    border-radius: 5px;
    resize: vertical; /* Allow vertical resize for textarea */
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}
button {
    padding: 10px 15px; /* More balanced padding */
    background: var(--accent);
    border: none;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease;
    white-space: nowrap; /* Evita quebra de linha do texto do botão */
}
button:hover {
    background-color: var(--button-hover);
}
#comments {
    margin-top: 20px;
    display: flex;
    flex-direction: column-reverse; /* Newest comments at the bottom (like chat) */
    gap: 15px; /* Spacing between chat messages */
}
.comment {
    background: var(--comment-bg);
    border: none; /* No border for chat look */
    padding: 12px 15px;
    border-radius: 8px; /* Rounded message bubbles */
    word-wrap: break-word; /* Ensure long words wrap */
    transition: background-color 0.3s ease, border-color 0.3s ease;
}
.comment.own {
    background: var(--comment-own-bg);
}
/* A classe .comment.admin não tem mais uma cor de background específica,
   herda de .comment ou .comment.own se for um comentário próprio do admin. */
.comment-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 5px;
}
.comment-author {
    font-weight: bold;
    color: var(--accent); /* Author name in accent color */
}
.comment.admin .comment-author {
    /* ESTILO PARA O NOME DO ADMIN NO TEMA ESCURO */
    color: #00bcd4; /* Azul ciano */
    text-shadow: 0 0 5px rgba(0, 188, 212, 0.5); /* Sombra para o ciano */
}
/* Estilo específico para o nome do admin no tema claro, se desejar diferente do tema escuro */
body:not(.dark-mode) .comment.admin .comment-author {
    color: #0097a7; /* Um azul ciano um pouco mais escuro para o tema claro */
    text-shadow: none; /* Sem brilho no tema claro */
    font-weight: bold; /* Manter negrito */
}

/* NOVO: Estilo para a imagem do admin */
.admin-icon {
    width:30px;/* Largura da imagem */
    height: 30px;/* Altura da imagem */
    margin-right: 4px; /* Espaçamento entre o ícone e o nome */
    border-radius: 3px; /* Bordas levemente arredondadas se for uma imagem quadrada */
}


.comment-timestamp {
    font-size: 0.8em;
    color: #b9bbbe; /* Um cinza mais claro para a data e hora */
}
body:not(.dark-mode) .comment-timestamp {
    color: #6c757d; /* Mais escuro para tema claro */
}
.comment.admin .comment-timestamp {
    color: #e0e0ff; /* Azul bem claro para a data e hora dos comentários do Admin (tema escuro) */
}
body:not(.dark-mode) .comment.admin .comment-timestamp {
    color: #a0a0ff; /* Mais escuro para tema claro */
}
.comment-message {
    margin-top: 5px;
    white-space: pre-wrap; /* Preserve whitespace and line breaks */
}
.comment-actions {
    margin-top: 8px;
    display: flex;
    flex-wrap: wrap; /* Permitir que os botões quebrem para a próxima linha */
    gap: 8px; /* Spacing between action buttons */
}
.comment-actions button {
    padding: 6px 10px; /* Smaller padding for action buttons */
    font-size: 0.85em;
    flex-grow: 1; /* Permite que os botões cresçam para preencher o espaço disponível, mas... */
    min-width: fit-content; /* Garante que o texto não seja cortado */
}
.admin-buttons {
    display: flex;
    flex-wrap: wrap; /* Permite que os botões do admin quebrem linha */
    gap: 8px;
    flex-grow: 1; /* Permite que o container dos botões de admin cresça */
    justify-content: flex-end; /* Alinha os botões de admin à direita dentro do seu container */
}
.admin-buttons button {
    background-color: #f04747; /* Red for delete/ban */
    flex-grow: 1; /* Deixa os botões de admin crescerem */
    min-width: fit-content; /* Garante que o texto não seja cortado */
}
.admin-buttons button:hover {
    background-color: #cc3a3a;
}

/* Custom Modal/Alert Styling */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    display: none; /* Hidden by default */
}
.modal-content {
    background: var(--container-bg); /* Usa a cor de fundo do container para o modal */
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    max-width: 450px;
    width: 90%;
    text-align: center;
    color: var(--fg);
    display: flex;
    flex-direction: column;
    gap: 20px;
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}
.modal-content input, .modal-content textarea {
    padding: 10px;
    background: var(--input-bg);
    border: 1px solid var(--border);
    color: var(--fg);
    border-radius: 5px;
    width: 100%;
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}
.modal-content .modal-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap; /* Permite que os botões do modal quebrem linha */
}
.modal-content .modal-buttons button {
    flex: 1;
    padding: 10px;
    min-width: 120px; /* Garante que os botões do modal tenham um tamanho mínimo */
}
.modal-content .modal-buttons .cancel-btn {
    background-color: #72767d;
}
.modal-content .modal-buttons .cancel-btn:hover {
    background-color: #5d6067;
}

#alert-box {
    display: none;
    background: #43b581; /* Discord green for success */
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    font-weight: bold;
    margin-bottom: 15px; /* Spacing below alert */
}
.error-alert {
    background: #f04747 !important; /* Discord red for errors */
}

/* --- Reply Box Styling (for composing a reply) --- */
#reply-box {
    background-color: var(--comment-bg);
    border-radius: 5px;
    padding: 8px 12px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9em;
    color: #b9bbbe;
    border-left: 3px solid var(--accent); /* Indicate it's a reply context */
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}
body:not(.dark-mode) #reply-box {
    color: #6c757d;
}
#reply-box .reply-message {
    flex-grow: 1;
    margin-right: 10px; /* Adiciona espaço entre a mensagem de resposta e o botão X */
}
#reply-box .cancel-reply-btn {
    background: none;
    border: none;
    color: #f04747; /* Red X */
    font-size: 1.2em;
    cursor: pointer;
    padding: 0 5px;
    flex-shrink: 0; /* Impede que o botão X encolha */
}
#reply-box .cancel-reply-btn:hover {
    color: #cc3a3a;
}
/* --- Styles for displaying a sent reply (quote block) --- */
.comment-reply-block {
    background-color: var(--reply-block-bg); /* Usar variável de tema */
    border-left: 4px solid var(--accent);
    padding: 8px 12px;
    border-radius: 5px;
    margin-bottom: 10px; /* Space between quote and current message */
    font-size: 0.9em;
    color: var(--fg);
    display: flex;
    flex-direction: column;
    gap: 4px;
    max-width: 100%; /* Ensure it fits within parent */
    transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
}
.comment-reply-block .reply-block-author {
    font-weight: bold;
    color: var(--accent); /* Same accent color for author */
}
.comment-reply-block .reply-block-message {
    font-style: italic;
    color: var(--reply-block-message); /* Usar variável de tema */
    overflow: hidden;
    white-space: nowrap; /* Keep snippet on one line */
    text-overflow: ellipsis; /* Add ellipsis if text is too long */
}
.comment-reply-block.comment-reply-deleted {
    background-color: #5d6067; /* Different color for deleted reply */
    border-left-color: #f04747; /* Red border for deleted */
    color: #f04747; /* Text color for deleted message */
}
body:not(.dark-mode) .comment-reply-block.comment-reply-deleted {
    background-color: #f8d7da; /* Mais claro para deleted no tema claro */
    color: #dc3545;
}
.comment-reply-block.comment-reply-deleted .reply-block-message {
    font-style: normal; /* No italics for deleted message text */
    color: #f04747;
}
body:not(.dark-mode) .comment-reply-block.comment-reply-deleted .reply-block-message {
    color: #dc3545;
}


/* ESTILO PARA QUEM RECEBEU A RESPOSTA (o background muda APENAS para ele) */
.comment.is-reply-to-me {
    background-color: var(--reply-highlight-bg);
    border-left: 5px solid var(--reply-highlight-border);
    padding-left: 15px;
}

/* Estilo para elementos markdown */
.comment-message strong {
    font-weight: bold;
    color: var(--fg); /* Adapta-se ao tema */
}
.comment-message em {
    font-style: italic;
    color: var(--reply-block-message); /* Adapta-se ao tema, mais discreto */
}
.comment-message u {
    text-decoration: underline;
    color: var(--reply-block-message); /* Adapta-se ao tema, mais discreto */
}
.comment-message code {
    font-family: "Consolas", monospace;
    background-color: var(--border); /* Adapta-se ao tema */
    color: var(--fg); /* Adapta-se ao tema */
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.9em;
}

/* Media query para telas menores que 600px */
@media (max-width: 600px) {
    .container {
        padding: 20px;
    }
    #user-controls {
        flex-direction: column; /* Empilha os botões de controle do usuário */
        align-items: stretch; /* Estica os botões para a largura total */
    }
    #user-controls button,
    #user-controls select {
        width: 100%; /* Faz com que os botões ocupem a largura total */
        margin-bottom: 5px; /* Adiciona um pequeno espaçamento entre eles */
    }
    .comment-actions {
        flex-direction: column; /* Empilha os botões de ação do comentário */
        align-items: stretch; /* Estica os botões */
    }
    .comment-actions button {
        width: 100%; /* Faz com que os botões de ação ocupem a largura total */
        margin-bottom: 5px; /* Adiciona um pequeno espaçamento entre eles */
    }
    .admin-buttons {
        flex-direction: column; /* Empilha os botões de admin */
        align-items: stretch; /* Estica os botões de admin */
    }
    .admin-buttons button {
        width: 100%; /* Faz com que os botões de admin ocupem a largura total */
        margin-bottom: 5px; /* Adiciona um pequeno espaçamento entre eles */
    }
    .modal-content .modal-buttons button {
        min-width: auto; /* Remove o min-width para permitir que se ajustem melhor */
    }
}

/* Media query para telas menores que 400px (ainda mais estreitas) */
@media (max-width: 400px) {
    body {
        padding: 10px; /* Reduz o padding do body em telas muito pequenas */
    }
    .container {
        padding: 15px; /* Reduz ainda mais o padding do container */
    }
    .comment {
        padding: 10px 12px; /* Reduz o padding dos comentários */
    }
    .comment-actions button,
    .admin-buttons button {
        font-size: 0.8em; /* Diminui a fonte dos botões de ação */
        padding: 8px; /* Ajusta o padding */
    }
}

  </style>
</head>
<body>
  <div class="container">
    <div id="alert-box"></div>
    <h2>Comentários</h2>
    <div id="user-info-section">
      <p id="user-info"></p>
      <p id="user-count"></p>
    </div>
    <div id="user-controls">
      <button id="login-btn">Registrar</button>
      <button id="logout-btn" style="display:none;">Sair</button>
      <button id="delete-account" style="display:none;">Apagar minha conta</button>
      <button id="theme-toggle" class="theme-toggle-btn">Mudar Tema</button>
    </div>

    <form id="comment-form">
      <input type="text" id="name" placeholder="Seu nome (só se não estiver logado)" style="display:none;" autocomplete="off" />
      <div id="reply-box" style="display:none;">
          <span class="reply-message"></span>
          <button type="button" class="cancel-reply-btn">X</button>
      </div>
      <textarea id="message" placeholder="Seu comentário" required rows="3" autocomplete="off"></textarea>
      <ul id="mention-suggestions"></ul>
      
      <button type="submit">Enviar</button>
    </form>
    <div id="comments"></div>
  </div>

  <div id="custom-modal" class="modal-overlay">
    <div class="modal-content">
      <p id="modal-message"></p>
      <input type="text" id="modal-input" style="display:none;" />
      <textarea id="modal-textarea" style="display:none;"></textarea>
      <div class="modal-buttons">
        <button id="modal-confirm-btn">Confirmar</button>
        <button id="modal-cancel-btn" class="cancel-btn" style="display:none;">Cancelar</button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
